services:
  app:
    build: .
    ports:
      - "8000:8000"
    environment:
      # Point utils.get_ngrok_url() to the ngrok API inside the compose network
      - NGROK_API_URL=http://ngrok:4040
      # Optional: override public ngrok URL if you prefer not to auto-discover
      - NGROK_URL=${NGROK_URL:-}
      - TIMEOUT_SECONDS=10
    depends_on:
      - ngrok

  ngrok:
    image: ngrok/ngrok:latest
    ports:
      - "4040:4040"

    environment:
      NGROK_AUTHTOKEN: ${NGROK_AUTHTOKEN}
      NGROK_REGION: us

    extra_hosts:
      - "host.docker.internal:host-gateway"

  command: http --log=stdout host.docker.internal:8000
